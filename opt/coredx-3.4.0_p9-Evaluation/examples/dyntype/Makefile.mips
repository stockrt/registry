# ***************************************************************
# 
#   file:  Makefile.mips
#   desc:  Makefile for CoreDX example Dynamic types applications
#  
# ***************************************************************
# 
#    Coypright(C) 2009-2011 Twin Oaks Computing, Inc
#    All rights reserved.   Castle Rock, CO 80108
# 
# ****************************************************************
# 
#   This file is provided by Twin Oaks Computing, Inc
#   as an example. It is provided in the hope that it will be
#   useful but WITHOUT ANY WARRANTY; without even the implied
#   warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
#   PURPOSE. TOC Inc assumes no liability or responsibilty for
#   the use of this information for any purpose.
#   
# ***************************************************************/

##########################################################
#
# This Makefile uses the following environment variables:
#  COREDX_TOP
#  COREDX_HOST
#  COREDX_TARGET
# These variables can be set manually, or determined by
# running the script  coredx/scripts/cdxenv.sh or cdxenv.bat
#
##########################################################


# Define our sources and objects
EXECUTABLE      = simplemsg_pub dyntype_pub_manual dyntype_pub_helpers simplemsg_sub dyntype_sub_manual dyntype_sub_discovery dyntype_sub_helpers

#########################################################
#
#  PUBLISHERS:
#

# Basic publisher sources and objects
simplemsg_pub_CSRCS         = simplemsg_pub.c
simplemsg_pub_COBJS         = ${simplemsg_pub_CSRCS:.c=.o}
simplemsg_pub_GENSRCS       = simplemsgTypeSupport.c simplemsgDataWriter.c simplemsg.c
simplemsg_pub_GENHDRS       = simplemsgTypeSupport.h simplemsgDataWriter.h simplemsg.h
simplemsg_pub_GENOBJS       = ${simplemsg_pub_GENSRCS:.c=.o}
simplemsg_pub_OBJS          = ${simplemsg_pub_GENOBJS} ${simplemsg_pub_COBJS} 

# Manually built DynamicType publisher sources and objects
dyntype_pub_manual_CSRCS    = dyntype_pub_manual.c
dyntype_pub_manual_COBJS    = ${dyntype_pub_manual_CSRCS:.c=.o}
dyntype_pub_manual_OBJS     = ${dyntype_pub_manual_COBJS}

# Generated DynamicType publisher sources and objects
dyntype_pub_helpers_CSRCS   = dyntype_pub_helpers.c
dyntype_pub_helpers_COBJS   = ${dyntype_pub_helpers_CSRCS:.c=.o}
dyntype_pub_helpers_GENSRCS = simplemsgTypeCode.c 
dyntype_pub_helpers_GENHDRS = simplemsgTypeCode.h 
dyntype_pub_helpers_GENOBJS = ${dyntype_pub_helpers_GENSRCS:.c=.o}
dyntype_pub_helpers_OBJS    = ${dyntype_pub_helpers_COBJS} ${dyntype_pub_helpers_GENOBJS}

#########################################################
# SUBSCRIBERS:
#

# Basic Subscriber for SimpleMsg
simplemsg_sub_CSRCS         = simplemsg_sub.c
simplemsg_sub_COBJS         = ${simplemsg_sub_CSRCS:.c=.o}
simplemsg_sub_GENSRCS       = simplemsgTypeSupport.c simplemsgDataReader.c simplemsg.c
simplemsg_sub_GENHDRS       = simplemsgTypeSupport.h simplemsgDataReader.h simplemsg.h
simplemsg_sub_GENOBJS       = ${simplemsg_sub_GENSRCS:.c=.o}
simplemsg_sub_OBJS          = ${simplemsg_sub_GENOBJS} ${simplemsg_sub_COBJS} 

# Manually built DynamicType Subscriber sources and objects
dyntype_sub_manual_CSRCS    = dyntype_sub_manual.c
dyntype_sub_manual_COBJS    = ${dyntype_sub_manual_CSRCS:.c=.o}
dyntype_sub_manual_OBJS     = ${dyntype_sub_manual_COBJS}

# Generated DynamicType Subscriber sources and objects
dyntype_sub_helpers_CSRCS   = dyntype_sub_helpers.c
dyntype_sub_helpers_COBJS   = ${dyntype_sub_helpers_CSRCS:.c=.o}
dyntype_sub_helpers_GENSRCS = simplemsgTypeCode.c 
dyntype_sub_helpers_GENHDRS = simplemsgTypeCode.h 
dyntype_sub_helpers_GENOBJS = ${dyntype_sub_helpers_GENSRCS:.c=.o}
dyntype_sub_helpers_OBJS    = ${dyntype_sub_helpers_COBJS} ${dyntype_sub_helpers_GENOBJS}

# DynamicType via discovery Subscriber sources and objects
dyntype_sub_discovery_CSRCS = dyntype_sub_discovery.c
dyntype_sub_discovery_COBJS = ${dyntype_sub_discovery_CSRCS:.c=.o}
dyntype_sub_discovery_OBJS  = ${dyntype_sub_discovery_COBJS}


##########################################################
# Setup Compile Environment
# We assume both gcc and coredx_ddl are in your path!

CC         = mips-linux-uclibc-gcc 
DDL        = ${COREDX_TOP}/host/${COREDX_HOST}/bin/coredx_ddl -e b

INC_PATH   = -I${COREDX_TOP}/target/include
LIB_PATH   = -L${COREDX_TOP}/target/${COREDX_TARGET}/lib
LIBS       = -Wl,-Bstatic -ldds_dyntype -ldds -Wl,-Bdynamic 

CFLAGS     = -Wall -O2 -g ${INC_PATH} 
LDFLAGS    = ${LIB_PATH} ${LIBS} -lnsl -lrt -lpthread

##########################################################
# Rules for compiling

all: ${EXECUTABLE} 

simplemsg_pub: ${simplemsg_pub_GENSRCS} ${simplemsg_pub_OBJS}
	${CC} -o $@ ${simplemsg_pub_OBJS} ${LDFLAGS} 

simplemsg_sub: ${simplemsg_sub_GENSRCS} ${simplemsg_sub_OBJS}
	${CC} -o $@ ${simplemsg_sub_OBJS} ${LDFLAGS} 

dyntype_pub_manual: ${dyntype_pub_manual_OBJS}
	${CC} -o $@ ${dyntype_pub_manual_OBJS} ${LDFLAGS} 

dyntype_pub_helpers: ${dyntype_pub_helpers_OBJS}
	${CC} -o $@ ${dyntype_pub_helpers_OBJS} ${LDFLAGS} 

dyntype_sub_discovery: ${dyntype_sub_discovery_OBJS}
	${CC} -o $@ ${dyntype_sub_discovery_OBJS} ${LDFLAGS} 

dyntype_sub_manual: ${dyntype_sub_manual_OBJS}
	${CC} -o $@ ${dyntype_sub_manual_OBJS} ${LDFLAGS} 

dyntype_sub_helpers: ${dyntype_sub_helpers_OBJS}
	${CC} -o $@ ${dyntype_sub_helpers_OBJS} ${LDFLAGS} 


##########################################################
# Rules for generating code from DDL

%.c : %.ddl
	${DDL} -f $<

%TypeCode.c :%.ddl
	${DDL} -i t -f $<

%TypeCode.h :%.ddl
	${DDL} -i t -f $<

%TypeSupport.c :%.ddl
	${DDL} -f $<

%DataWriter.c :%.ddl
	${DDL} -f $<

%DataReader.c :%.ddl
	${DDL} -f $<


##########################################################
# Rules for cleaning

clean:
	\rm -f ${simplemsg_pub_OBJS} ${dyntype_pub_manual_OBJS} ${dyntype_pub_helpers_OBJS} ${simplemsg_sub_OBJS} ${dyntype_sub_discovery_OBJS} ${dyntype_sub_manual_OBJS} ${dyntype_sub_helpers_OBJS} ${EXECUTABLE}

reallyclean: clean
	\rm -f ${simplemsg_pub_GENSRCS} ${simplemsg_pub_GENHDRS} ${dyntype_pub_helpers_GENSRCS} ${simplemsg_sub_GENSRCS} ${simplemsg_sub_GENHDRS} ${dyntype_sub_helpers_GENSRCS} ${dyntype_sub_helpers_GENHDRS} simplemsgDataReader.c simplemsgDataReader.h


##########################################################
# Additional dependencies
simplemsg_pub.o: simplemsg.h simplemsgTypeSupport.h simplemsgDataWriter.h
simplemsgTypeSupport.o: simplemsgTypeSupport.c simplemsg.h simplemsgTypeSupport.h
simplemsgDataReader.o: simplemsgDataReader.c simplemsg.h
simplemsgDataWriter.o: simplemsgDataWriter.c simplemsg.h
simplemsg.o: simplemsg.c simplemsg.h

dyntype_pub_helpers.o: simplemsg.h simplemsgTypeCode.h 
dyntype_sub_helpers.o: simplemsg.h simplemsgTypeCode.h 
simplemsgTypeCode.o: simplemsgTypeCode.h simplemsgTypeCode.c
