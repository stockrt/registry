# ***************************************************************
# 
#   file:  Makefile.vxworks6_rtp
#   desc:  Makefile for CoreDX example ContentFilter examples
#  
# ***************************************************************
# 
#    Coypright(C) 2008-2011 Twin Oaks Computing, Inc
#    All rights reserved.   Castle Rock, CO 80108
# 
# ****************************************************************
# 
#   This file is provided by Twin Oaks Computing, Inc
#   as an example. It is provided in the hope that it will be 
#   useful but WITHOUT ANY WARRANTY; without even the implied
#   warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
#   PURPOSE. TOC Inc assumes no liability or responsibilty for
#   the use of this information for any purpose.
#   
# ***************************************************************/

##########################################################
#
# This Makefile uses the following environment variables:
#  COREDX_TOP
#  COREDX_HOST
#  COREDX_TARGET
# These variables can be set manually, or determined by
# running the script  coredx/scripts/cdxenv.sh or cdxenv.bat
#
##########################################################

# Define our sources and objects
EXECUTABLE        = filter_pub filter_sub

# Publisher sources and objects
filter_pub_CSRCS   = filter_pub.cc
filter_pub_COBJS   = ${filter_pub_CSRCS:.cc=.o}

filter_pub_GENSRCS = filterTypeSupport.cc filterDataWriter.cc filterDataReader.cc filter.cc
filter_pub_GENHDRS = filterTypeSupport.hh filterDataWriter.hh filter.hh
filter_pub_GENOBJS = ${filter_pub_GENSRCS:.cc=.o}

filter_pub_OBJS    = ${filter_pub_GENOBJS} ${filter_pub_COBJS} 

# Subscriber sources and objects
filter_sub_CSRCS   = filter_sub.cc
filter_sub_COBJS   = ${filter_sub_CSRCS:.cc=.o}

filter_sub_GENSRCS = filterTypeSupport.cc filterDataReader.cc filterDataWriter.cc filter.cc
filter_sub_GENHDRS = filterTypeSupport.hh filterDataReader.hh filter.hh
filter_sub_GENOBJS = ${filter_sub_GENSRCS:.cc=.o}

filter_sub_OBJS    = ${filter_sub_GENOBJS} ${filter_sub_COBJS}

##########################################################
# Setup Compile Environment

CXX        = g++pentium
DDL        = ${COREDX_TOP}/host/${COREDX_HOST}/bin/coredx_ddl

INC_PATH   = -I${COREDX_TOP}/target/include
LIB_PATH   = -L${WIND_BASE}/target/usr/lib/pentium/PENTIUM/common -L${COREDX_TOP}/target/${COREDX_TARGET}/lib

LIBS       = -ldds_cpp_cf -ldds_cf 

CXXFLAGS     = -mtune=i486 -march=i486 -ansi -mrtp -MD -MP -D_VX_CPU=_VX_PENTIUM -D_VX_TOOL_FAMILY=gnu -D_VX_TOOL=gnu -Wall -O2 -g ${INC_PATH} 
LDFLAGS    = -mrtp ${LIB_PATH} ${LIBS}


##########################################################

all: ${EXECUTABLE} 

filter_pub: ${filter_GENSRCS} ${filter_pub_OBJS}
	${CXX} -o $@ ${filter_pub_OBJS} ${LDFLAGS} 

filter_sub: ${filter_GENSRCS} ${filter_sub_OBJS}
	${CXX} -o $@ ${filter_sub_OBJS} ${LDFLAGS} 

##########################################################
# Rules for generating code from DDL

filter.cc : filter.ddl
	${DDL} -l cpp -f $<

%TypeSupport.cc :%.ddl
	${DDL} -l cpp -f $<

%DataWriter.cc :%.ddl
	${DDL} -l cpp -f $<

%DataReader.cc :%.ddl
	${DDL} -l cpp -f $<

##########################################################
# Rules for cleaning

clean:
	\rm -f ${filter_pub_OBJS} ${filter_sub_OBJS} ${EXECUTABLE}

reallyclean: clean
	\rm -f ${filter_pub_GENSRCS} ${filter_pub_GENHDRS} ${filter_sub_GENSRCS} ${filter_sub_GENHDRS} 


##########################################################
# Additional Dependencies
filter_pub.o: filter.hh filterTypeSupport.hh filterDataWriter.hh
filter_sub.o: filter.hh filterTypeSupport.hh filterDataReader.hh
filterTypeSupport.o: filterTypeSupport.cc filter.hh filterTypeSupport.hh
filterDataReader.o: filterDataReader.cc filter.hh filterDataReader.hh
filterDataWriter.o: filterDataWriter.cc filter.hh filterDataWriter.hh
filter.o: filter.cc filter.hh
