# ***************************************************************
# 
#   file:  NMakefile
#   desc:  Makefile for CoreDX example ContentFilter applications
#  
# ***************************************************************
# 
#    Coypright(C) 2008-2011 Twin Oaks Computing, Inc
#    All rights reserved.   Castle Rock, CO 80108
# 
# ****************************************************************
# 
#   This file is provided by Twin Oaks Computing, Inc
#   as an example. It is provided in the hope that it will be 
#   useful but WITHOUT ANY WARRANTY; without even the implied
#   warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
#   PURPOSE. TOC Inc assumes no liability or responsibilty for
#   the use of this information for any purpose.
#   
# ***************************************************************/


##########################################################
#
# This Makefile uses the following environment variables:
#  COREDX_TOP
#  COREDX_HOST
#  COREDX_TARGET
# These variables can be set manually, or determined by
# running the script  coredx/scripts/cdxenv.sh or cdxenv.bat
#
##########################################################

# Define our sources and objects
EXECUTABLE        = filter_pub.exe filter_sub.exe

# generated source code
GENSRCS           = filterTypeSupport.cc filterDataReader.cc filterDataWriter.cc filter.cc
GENHDRS           = filterTypeSupport.hh filterDataReader.hh filterDataWriter.hh filter.hh
GENOBJS           = $(GENSRCS:.cc=.obj)

# Publisher sources and objects
filter_pub_CSRCS   = filter_pub.cc
filter_pub_COBJS   = $(filter_pub_CSRCS:.cc=.obj)
filter_pub_OBJS    = $(GENOBJS) $(filter_pub_COBJS)

# Subscriber sources and objects
filter_sub_CSRCS   = filter_sub.cc
filter_sub_COBJS   = $(filter_sub_CSRCS:.cc=.obj)
filter_sub_OBJS    = $(GENOBJS) $(filter_sub_COBJS)

##########################################################
# Setup Compile Environment
# We assume both gcc and coredx_ddl are in your path!
CC         = cl.exe
DDL        = $(COREDX_TOP)\host\$(COREDX_HOST)\bin\coredx_ddl.exe

INC_PATH   = -I$(COREDX_TOP)\target\include
LIBS       = $(COREDX_TOP)\target\$(COREDX_TARGET)\lib\dds_cpp_cf_static.lib $(COREDX_TOP)\target\$(COREDX_TARGET)\lib\dds_cf_static.lib WS2_32.lib Iphlpapi.lib winmm.lib user32.lib gdi32.lib shell32.lib advapi32.lib 
CFLAGS     = /nologo /MT /EHsc $(INC_PATH) 

##########################################################
# Rules for compiling

all: $(EXECUTABLE) 

filter_pub.exe: $(filter_pub_OBJS)
	cl.exe /nologo /Fe$@ $** -link $(LIBS) 

filter_sub.exe:  $(filter_sub_OBJS)
	cl.exe /nologo /Fe$@ $** -link $(LIBS) 


##########################################################
# Rules for generating code from DDL

$(GENSRCS) $(GENHDRS): filter.ddl
	$(DDL) -l cpp -f $**

##########################################################
# Rules for cleaning

clean:
	del  $(filter_pub_OBJS) $(filter_sub_OBJS) $(EXECUTABLE)

reallyclean: clean
	del $(GENSRCS) $(GENHDRS) 


##########################################################
# Additional dependencies
filter_pub.obj: filter.hh filterTypeSupport.hh filterDataWriter.hh
filter_sub.obj: filter.hh filterTypeSupport.hh filterDataReader.hh
filterTypeSupport.obj: filterTypeSupport.cc filter.hh filterTypeSupport.hh
filterDataReader.obj: filterDataReader.cc filter.hh
filterDataWriter.obj: filterDataWriter.cc filter.hh
filter.obj: filter.cc filter.hh
