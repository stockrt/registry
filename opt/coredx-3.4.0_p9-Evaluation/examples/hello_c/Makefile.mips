# ***************************************************************
# 
#   file:  Makefile.mips
#   desc:  Makefile for CoreDX example Hello World applications
#  
# ***************************************************************
# 
#    Coypright(C) 2006-2011 Twin Oaks Computing, Inc
#    All rights reserved.   Castle Rock, CO 80108
# 
# ****************************************************************
# 
#   This file is provided by Twin Oaks Computing, Inc
#   as an example. It is provided in the hope that it will be 
#   useful but WITHOUT ANY WARRANTY; without even the implied 
#   warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR 
#   PURPOSE. TOC Inc assumes no liability or responsibilty for 
#   the use of this information for any purpose.
#   
# ***************************************************************/

##########################################################
#
# This Makefile uses the following environment variables:
#  COREDX_TOP
#  COREDX_HOST
#  COREDX_TARGET
# These variables can be set manually, or determined by
# running the script  coredx/scripts/cdxenv.sh or cdxenv.bat
#
##########################################################


# Define our sources and objects
EXECUTABLE      = hello_pub hello_sub

# Publisher sources and objects
hello_pub_CSRCS = hello_pub.c
hello_pub_COBJS = ${hello_pub_CSRCS:.c=.o}

hello_pub_GENSRCS     = helloTypeSupport.c helloDataWriter.c hello.c
hello_pub_GENHDRS     = helloTypeSupport.h helloDataWriter.h hello.h
hello_pub_GENOBJS     = ${hello_pub_GENSRCS:.c=.o}

hello_pub_OBJS = ${hello_pub_GENOBJS} ${hello_pub_COBJS} 

# Subscriber sources and objects
hello_sub_CSRCS = hello_sub.c
hello_sub_COBJS = ${hello_sub_CSRCS:.c=.o}

hello_sub_GENSRCS     = helloTypeSupport.c helloDataReader.c hello.c
hello_sub_GENHDRS     = helloTypeSupport.h helloDataReader.h hello.h
hello_sub_GENOBJS     = ${hello_sub_GENSRCS:.c=.o}

hello_sub_OBJS = ${hello_sub_GENOBJS} ${hello_sub_COBJS}

##########################################################
# Setup Compile Environment
# We assume both gcc and coredx_ddl are in your path!

CC         = mips-linux-uclibc-gcc 
DDL        = ${COREDX_TOP}/host/${COREDX_HOST}/bin/coredx_ddl -e b

INC_PATH   = -I${COREDX_TOP}/target/include
LIB_PATH   = -L${COREDX_TOP}/target/${COREDX_TARGET}/lib
LIBS       = -Wl,-Bstatic -ldds -Wl,-Bdynamic 

CFLAGS     = -Wall -O2 -g ${INC_PATH} 
LDFLAGS    = ${LIB_PATH} ${LIBS} -lnsl -lrt -lpthread

##########################################################
# Rules for compiling

all: ${EXECUTABLE} 

hello_pub: ${hello_pub_GENSRCS} ${hello_pub_OBJS}
	${CC} -o $@ ${hello_pub_OBJS} ${LDFLAGS} 

hello_sub: ${hello_sub_GENSRCS} ${hello_sub_OBJS}
	${CC} -o $@ ${hello_sub_OBJS} ${LDFLAGS} 


##########################################################
# Rules for generating code from DDL

%.c : %.ddl
	${DDL} -f $<

%TypeSupport.c :%.ddl
	${DDL} -f $<

%DataWriter.c :%.ddl
	${DDL} -f $<

%DataReader.c :%.ddl
	${DDL} -f $<


##########################################################
# Rules for cleaning

clean:
	\rm -f ${hello_pub_OBJS} ${hello_sub_OBJS} ${EXECUTABLE}

reallyclean: clean
	\rm -f ${hello_pub_GENSRCS} ${hello_pub_GENHDRS} ${hello_sub_GENSRCS} ${hello_sub_GENHDRS}


##########################################################
# Additional dependencies
hello_pub.o: hello.h helloTypeSupport.h helloDataWriter.h
hello_sub.o: hello.h helloTypeSupport.h helloDataReader.h
helloTypeSupport.o: helloTypeSupport.c hello.h helloTypeSupport.h
helloDataReader.o: helloDataReader.c hello.h
helloDataWriter.o: helloDataWriter.c hello.h
hello.o: hello.c hello.h
