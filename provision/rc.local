#!/bin/bash
#
# rc.local
#
# This script is executed at the end of each multiuser runlevel.
# Make sure that the script will "exit 0" on success or any other
# value on error.
#
# In order to enable or disable this script just change the execution
# bits.
#
# By default this script does nothing.

# Make sure eth0 is working. This works around Vagrant issue #391
dhclient eth0 >/dev/null 2>&1

service mysql restart

iptables -F
iptables -X
iptables -Z
iptables -F -t nat
iptables -X -t nat
iptables -Z -t nat
iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-port 9000

source /config.sh
su - $USER_APP -c "bash $REGISTRY_HOME/provision/gateway.sh &"
su - $USER_APP -c "bash $REGISTRY_HOME/provision/registry-server.sh -DapplyEvolutions.default=true start &"

exit 0
